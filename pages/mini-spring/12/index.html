<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Spring12ï¼šé€šè¿‡æ³¨è§£é…ç½®å’ŒåŒ…è‡ªåŠ¨æ‰«æçš„æ–¹å¼å®ŒæˆBeanå¯¹è±¡çš„æ³¨å†Œ | My Dearest</title><meta name="author" content="Animenzzzzzz"><meta name="copyright" content="Animenzzzzzz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="å‰è¨€ å¦‚æœæˆ‘ä»¬èƒ½åœ¨å®Œæˆç›®çš„çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯å¸Œæœ›å°½å¯èƒ½æµç¨‹ç®€å•ã€æ¨¡å¼æ¸…æ™°ã€è‡ªåŠ¨æœåŠ¡ã€‚é‚£è¿™åœ¨Springçš„æ¡†æ¶ä¸­ä¹Ÿæ˜¯æœ‰æ‰€ä½“ç°çš„ï¼Œè¿™ä¸ªæ¡†æ¶çš„æ™®åŠä½¿ç”¨ç¨‹åº¦å’Œå®ƒæ‰€èƒ½å¸¦æ¥çš„æ–¹ä¾¿æ€§æ˜¯åˆ†ä¸å¼€çš„ï¼Œè€Œæˆ‘ä»¬å¦‚æœèƒ½åšåˆ°å¦‚æ­¤çš„æ–¹ä¾¿ï¼Œé‚£è‚¯å®šæ˜¯ä¸€ç§å¥½çš„è®¾è®¡å’Œå®ç°ã€‚ ç›®æ ‡ å…¶å®åˆ°æœ¬ç« èŠ‚æˆ‘ä»¬å·²ç»æŠŠå…³äº IOC å’Œ AOP å…¨éƒ¨æ ¸å¿ƒå†…å®¹éƒ½å·²ç»å®ç°å®Œæˆäº†ï¼Œåªä¸è¿‡åœ¨ä½¿ç”¨ä¸Šè¿˜æœ‰ç‚¹åƒæ—©æœŸçš„ Spring ç‰ˆæœ¬ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ¨ spr">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring12ï¼šé€šè¿‡æ³¨è§£é…ç½®å’ŒåŒ…è‡ªåŠ¨æ‰«æçš„æ–¹å¼å®ŒæˆBeanå¯¹è±¡çš„æ³¨å†Œ">
<meta property="og:url" content="https://animenzzzzzz.github.io/pages/mini-spring/12/index.html">
<meta property="og:site_name" content="My Dearest">
<meta property="og:description" content="å‰è¨€ å¦‚æœæˆ‘ä»¬èƒ½åœ¨å®Œæˆç›®çš„çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯å¸Œæœ›å°½å¯èƒ½æµç¨‹ç®€å•ã€æ¨¡å¼æ¸…æ™°ã€è‡ªåŠ¨æœåŠ¡ã€‚é‚£è¿™åœ¨Springçš„æ¡†æ¶ä¸­ä¹Ÿæ˜¯æœ‰æ‰€ä½“ç°çš„ï¼Œè¿™ä¸ªæ¡†æ¶çš„æ™®åŠä½¿ç”¨ç¨‹åº¦å’Œå®ƒæ‰€èƒ½å¸¦æ¥çš„æ–¹ä¾¿æ€§æ˜¯åˆ†ä¸å¼€çš„ï¼Œè€Œæˆ‘ä»¬å¦‚æœèƒ½åšåˆ°å¦‚æ­¤çš„æ–¹ä¾¿ï¼Œé‚£è‚¯å®šæ˜¯ä¸€ç§å¥½çš„è®¾è®¡å’Œå®ç°ã€‚ ç›®æ ‡ å…¶å®åˆ°æœ¬ç« èŠ‚æˆ‘ä»¬å·²ç»æŠŠå…³äº IOC å’Œ AOP å…¨éƒ¨æ ¸å¿ƒå†…å®¹éƒ½å·²ç»å®ç°å®Œæˆäº†ï¼Œåªä¸è¿‡åœ¨ä½¿ç”¨ä¸Šè¿˜æœ‰ç‚¹åƒæ—©æœŸçš„ Spring ç‰ˆæœ¬ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ¨ spr">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://animenzzzzzz.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2024-10-12T03:38:15.000Z">
<meta property="article:modified_time" content="2025-02-21T08:53:16.893Z">
<meta property="article:author" content="Animenzzzzzz">
<meta property="article:tag" content="mini-spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://animenzzzzzz.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://animenzzzzzz.github.io/pages/mini-spring/12/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>(()=>{
      const saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
      
      window.btf = {
        saveToLocal: saveToLocal,
        getScript: (url, attr = {}) => new Promise((resolve, reject) => {
          const script = document.createElement('script')
          script.src = url
          script.async = true
          script.onerror = reject
          script.onload = script.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            script.onload = script.onreadystatechange = null
            resolve()
          }

          Object.keys(attr).forEach(key => {
            script.setAttribute(key, attr[key])
          })

          document.head.appendChild(script)
        }),

        getCSS: (url, id = false) => new Promise((resolve, reject) => {
          const link = document.createElement('link')
          link.rel = 'stylesheet'
          link.href = url
          if (id) link.id = id
          link.onerror = reject
          link.onload = link.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            link.onload = link.onreadystatechange = null
            resolve()
          }
          document.head.appendChild(link)
        }),

        addGlobalFn: (key, fn, name = false, parent = window) => {
          const pjaxEnable = false
          if (!pjaxEnable && key.startsWith('pjax')) return

          const globalFn = parent.globalFn || {}
          const keyObj = globalFn[key] || {}
    
          if (name && keyObj[name]) return
    
          name = name || Object.keys(keyObj).length
          keyObj[name] = fn
          globalFn[key] = keyObj
          parent.globalFn = globalFn
        }
      }
    
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode
      
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })()</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring12ï¼šé€šè¿‡æ³¨è§£é…ç½®å’ŒåŒ…è‡ªåŠ¨æ‰«æçš„æ–¹å¼å®ŒæˆBeanå¯¹è±¡çš„æ³¨å†Œ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-02-21 16:53:16'
}</script><link rel="stylesheet" href="/css/font.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">11</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/top_img.jpg);"><nav id="nav"><span id="blog-info"><a href="/" title="My Dearest"><span class="site-name">My Dearest</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Spring12ï¼šé€šè¿‡æ³¨è§£é…ç½®å’ŒåŒ…è‡ªåŠ¨æ‰«æçš„æ–¹å¼å®ŒæˆBeanå¯¹è±¡çš„æ³¨å†Œ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-10-12T03:38:15.000Z" title="å‘è¡¨äº 2024-10-12 11:38:15">2024-10-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-02-21T08:53:16.893Z" title="æ›´æ–°äº 2025-02-21 16:53:16">2025-02-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Computer/">Computer</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Computer/Java/">Java</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="å‰è¨€">å‰è¨€</h1>
<p>å¦‚æœæˆ‘ä»¬èƒ½åœ¨å®Œæˆç›®çš„çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯å¸Œæœ›å°½å¯èƒ½æµç¨‹ç®€å•ã€æ¨¡å¼æ¸…æ™°ã€è‡ªåŠ¨æœåŠ¡ã€‚é‚£è¿™åœ¨Springçš„æ¡†æ¶ä¸­ä¹Ÿæ˜¯æœ‰æ‰€ä½“ç°çš„ï¼Œè¿™ä¸ªæ¡†æ¶çš„æ™®åŠä½¿ç”¨ç¨‹åº¦å’Œå®ƒæ‰€èƒ½å¸¦æ¥çš„æ–¹ä¾¿æ€§æ˜¯åˆ†ä¸å¼€çš„ï¼Œè€Œæˆ‘ä»¬å¦‚æœèƒ½åšåˆ°å¦‚æ­¤çš„æ–¹ä¾¿ï¼Œé‚£è‚¯å®šæ˜¯ä¸€ç§å¥½çš„è®¾è®¡å’Œå®ç°ã€‚</p>
<h1 id="ç›®æ ‡">ç›®æ ‡</h1>
<p>å…¶å®åˆ°æœ¬ç« èŠ‚æˆ‘ä»¬å·²ç»æŠŠå…³äº IOC å’Œ AOP
å…¨éƒ¨æ ¸å¿ƒå†…å®¹éƒ½å·²ç»å®ç°å®Œæˆäº†ï¼Œåªä¸è¿‡åœ¨ä½¿ç”¨ä¸Šè¿˜æœ‰ç‚¹åƒæ—©æœŸçš„ Spring
ç‰ˆæœ¬ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ¨ spring.xml ä¸­è¿›è¡Œé…ç½®ã€‚è¿™ä¸å®é™…çš„ç›®å‰ä½¿ç”¨çš„ Spring
æ¡†æ¶è¿˜æ˜¯æœ‰è›®å¤§çš„å·®åˆ«ï¼Œè€Œè¿™ç§å·®åˆ«å…¶å®éƒ½æ˜¯åœ¨æ ¸å¿ƒåŠŸèƒ½é€»è¾‘ä¹‹ä¸Šå»ºè®¾çš„åœ¨æ›´å°‘çš„é…ç½®ä¸‹ï¼Œåšåˆ°æ›´ç®€åŒ–çš„ä½¿ç”¨ã€‚</p>
<p>è¿™å…¶ä¸­å°±åŒ…æ‹¬ï¼šåŒ…çš„æ‰«ææ³¨å†Œã€æ³¨è§£é…ç½®çš„ä½¿ç”¨ã€å ä½ç¬¦å±æ€§çš„å¡«å……ç­‰ç­‰ï¼Œè€Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åœ¨ç›®å‰çš„æ ¸å¿ƒé€»è¾‘ä¸Šå¡«å……ä¸€äº›è‡ªåŠ¨åŒ–çš„åŠŸèƒ½ï¼Œè®©å¤§å®¶å¯ä»¥å­¦ä¹ åˆ°è¿™éƒ¨åˆ†çš„è®¾è®¡å’Œå®ç°ï¼Œä»ä¸­ä½“ä¼šåˆ°ä¸€äº›å…³äºä»£ç é€»è¾‘çš„å®ç°è¿‡ç¨‹ï¼Œæ€»ç»“ä¸€äº›ç¼–ç ç»éªŒã€‚</p>
<h1 id="æ–¹æ¡ˆ">æ–¹æ¡ˆ</h1>
<p>é¦–å…ˆæˆ‘ä»¬è¦è€ƒè™‘ğŸ¤”ï¼Œä¸ºäº†å¯ä»¥ç®€åŒ– Bean å¯¹è±¡çš„é…ç½®ï¼Œè®©æ•´ä¸ª Bean
å¯¹è±¡çš„æ³¨å†Œéƒ½æ˜¯è‡ªåŠ¨æ‰«æçš„ï¼Œé‚£ä¹ˆåŸºæœ¬éœ€è¦çš„å…ƒç´ åŒ…æ‹¬ï¼šæ‰«æè·¯å¾„å…¥å£ã€XMLè§£ææ‰«æä¿¡æ¯ã€ç»™éœ€è¦æ‰«æçš„Beanå¯¹è±¡åšæ³¨è§£æ ‡è®°ã€æ‰«æClasså¯¹è±¡æ‘˜å–Beanæ³¨å†Œçš„åŸºæœ¬ä¿¡æ¯ï¼Œç»„è£…æ³¨å†Œä¿¡æ¯ã€æ³¨å†ŒæˆBeanå¯¹è±¡ã€‚é‚£ä¹ˆåœ¨è¿™äº›æ¡ä»¶å…ƒç´ çš„æ”¯æ’‘ä¸‹ï¼Œå°±å¯ä»¥å®ç°å‡ºé€šè¿‡è‡ªå®šä¹‰æ³¨è§£å’Œé…ç½®æ‰«æè·¯å¾„çš„æƒ…å†µä¸‹ï¼Œå®Œæˆ
Bean
å¯¹è±¡çš„æ³¨å†Œã€‚é™¤æ­¤ä¹‹å¤–å†é¡ºå¸¦è§£å†³ä¸€ä¸ªé…ç½®ä¸­å ä½ç¬¦å±æ€§çš„çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡
${token} ç»™ Bean å¯¹è±¡æ³¨å…¥è¿›å»å±æ€§ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œéœ€è¦ç”¨åˆ°
BeanFactoryPostProcessorï¼Œå› ä¸ºå®ƒå¯ä»¥å¤„ç† åœ¨æ‰€æœ‰çš„ BeanDefinition
åŠ è½½å®Œæˆåï¼Œå®ä¾‹åŒ– Bean å¯¹è±¡ä¹‹å‰ï¼Œæä¾›ä¿®æ”¹ BeanDefinition å±æ€§çš„æœºåˆ¶
è€Œå®ç°è¿™éƒ¨åˆ†å†…å®¹æ˜¯ä¸ºäº†åç»­æŠŠæ­¤ç±»å†…å®¹ç»“åˆåˆ°è‡ªåŠ¨åŒ–é…ç½®å¤„ç†ä¸­ã€‚</p>
<p>ç»“åˆbeançš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‰«æåªä¸è¿‡æ˜¯æ‰«æç‰¹å®šæ³¨è§£çš„ç±»ï¼Œæå–ç±»çš„ç›¸å…³ä¿¡æ¯ç»„è£…æˆBeanDefinitionæ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚</p>
<p>åœ¨XmlBeanDefinitionReaderä¸­è§£æ<context:component-scan />æ ‡ç­¾ï¼Œæ‰«æç±»ç»„è£…BeanDefinitionç„¶åæ³¨å†Œåˆ°å®¹å™¨ä¸­çš„æ“ä½œåœ¨ClassPathBeanDefinitionScanner#doScanä¸­å®ç°ã€‚</p>
<ul>
<li><p>è‡ªåŠ¨æ‰«ææ³¨å†Œä¸»è¦æ˜¯æ‰«ææ·»åŠ äº†è‡ªå®šä¹‰æ³¨è§£çš„ç±»ï¼Œåœ¨xmlåŠ è½½è¿‡ç¨‹ä¸­æå–ç±»çš„ä¿¡æ¯ï¼Œç»„è£…
BeanDefinition æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚</p></li>
<li><p>æ‰€ä»¥æˆ‘ä»¬ä¼šç”¨åˆ° <context:component-scan /> é…ç½®åŒ…è·¯å¾„å¹¶åœ¨
XmlBeanDefinitionReader
è§£æå¹¶åšç›¸åº”çš„å¤„ç†ã€‚è¿™é‡Œçš„å¤„ç†ä¼šåŒ…æ‹¬å¯¹ç±»çš„æ‰«æã€è·å–æ³¨è§£ä¿¡æ¯ç­‰</p></li>
<li><p>æœ€åè¿˜åŒ…æ‹¬äº†ä¸€éƒ¨åˆ†å…³äº BeanFactoryPostProcessor
çš„ä½¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®Œæˆå¯¹å ä½ç¬¦é…ç½®ä¿¡æ¯çš„åŠ è½½ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨åˆ°
BeanFactoryPostProcessor åœ¨æ‰€æœ‰çš„ BeanDefinition åŠ è½½å®Œæˆåï¼Œå®ä¾‹åŒ– Bean
å¯¹è±¡ä¹‹å‰ï¼Œä¿®æ”¹ BeanDefinition
çš„å±æ€§ä¿¡æ¯ã€‚è¿™ä¸€éƒ¨åˆ†çš„å®ç°ä¹Ÿä¸ºåç»­å¤„ç†å…³äºå ä½ç¬¦é…ç½®åˆ°æ³¨è§£ä¸Šåšå‡†å¤‡</p></li>
</ul>
<h1 id="å®ç°">å®ç°</h1>
<h2 id="å·¥ç¨‹ç»“æ„">å·¥ç¨‹ç»“æ„</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">mini-spring</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ main</span><br><span class="line">        â””â”€â”€ java</span><br><span class="line">            â””â”€â”€ io.github.animenzzzzzz</span><br><span class="line">                â”‚â”€â”€ aop</span><br><span class="line">                â”‚   â”œâ”€â”€ aspectj</span><br><span class="line">                â”‚   â”‚   â””â”€â”€ AspectJExpressionPointcut.java</span><br><span class="line">                â”‚   â”‚   â””â”€â”€ AspectJExpressionPointcutAdvisor.java</span><br><span class="line">                â”‚   â”œâ”€â”€ framework </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ adapter</span><br><span class="line">                â”‚   â”‚   â”‚   â””â”€â”€ MethodBeforeAdviceInterceptor.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ autoproxy</span><br><span class="line">                â”‚   â”‚   â”‚   â””â”€â”€ MethodBeforeAdviceInterceptor.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ AopProxy.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ CglibAopProxy.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ JdkDynamicAopProxy.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ProxyFactory.java</span><br><span class="line">                â”‚   â”‚   â””â”€â”€ ReflectiveMethodInvocation.java</span><br><span class="line">                â”‚   â”œâ”€â”€ AdvisedSupport.java</span><br><span class="line">                â”‚   â”œâ”€â”€ Advisor.java</span><br><span class="line">                â”‚   â”œâ”€â”€ BeforeAdvice.java</span><br><span class="line">                â”‚   â”œâ”€â”€ ClassFilter.java</span><br><span class="line">                â”‚   â”œâ”€â”€ MethodBeforeAdvice.java</span><br><span class="line">                â”‚   â”œâ”€â”€ MethodMatcher.java</span><br><span class="line">                â”‚   â”œâ”€â”€ Pointcut.java</span><br><span class="line">                â”‚   â”œâ”€â”€ PointcutAdvisor.java</span><br><span class="line">                â”‚   â””â”€â”€ TargetSource.java</span><br><span class="line">                â”‚â”€â”€ beans</span><br><span class="line">                â”‚   â”œâ”€â”€ factory</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ config</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ AutowireCapableBeanFactory.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinition.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ BeanFactoryPostProcessor.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ BeanPostProcessor.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ BeanReference.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigurableBeanFactory.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ InstantiationAwareBeanPostProcessor.java</span><br><span class="line">                â”‚   â”‚   â”‚   â””â”€â”€ SingletonBeanRegistry.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ support</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractAutowireCapableBeanFactory.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractBeanDefinitionReader.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractBeanFactory.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinitionReader.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinitionRegistry.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ CglibSubclassingInstantiationStrategy.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ DefaultListableBeanFactory.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ DefaultSingletonBeanRegistry.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ DisposableBeanAdapter.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ FactoryBeanRegistrySupport.java</span><br><span class="line">                â”‚   â”‚   â”‚   â”œâ”€â”€ InstantiationStrategy.java</span><br><span class="line">                â”‚   â”‚   â”‚   â””â”€â”€ SimpleInstantiationStrategy.java  </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ xml</span><br><span class="line">                â”‚   â”‚   â”‚   â””â”€â”€ XmlBeanDefinitionReader.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ Aware.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ BeanClassLoaderAware.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ BeanFactory.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ BeanFactoryAware.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ BeanNameAware.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ConfigurableListableBeanFactory.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ DisposableBean.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ FactoryBean.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ HierarchicalBeanFactory.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ InitializingBean.java</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ListableBeanFactory.java</span><br><span class="line">                â”‚   â”‚   â””â”€â”€ PropertyPlaceholderConfigurer.java</span><br><span class="line">                â”‚   â”œâ”€â”€ BeansException.java</span><br><span class="line">                â”‚   â”œâ”€â”€ PropertyValue.java</span><br><span class="line">                â”‚   â””â”€â”€ PropertyValues.java </span><br><span class="line">                â”‚â”€â”€ context</span><br><span class="line">                â”‚   â”œâ”€â”€ annotation</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ClassPathBeanDefinitionScanner.java </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ClassPathScanningCandidateComponentProvider.java </span><br><span class="line">                â”‚   â”‚   â””â”€â”€ Scope.java </span><br><span class="line">                â”‚   â”œâ”€â”€ event</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ AbstractApplicationEventMulticaster.java </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ApplicationContextEvent.java </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ApplicationEventMulticaster.java </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ContextClosedEvent.java </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ContextRefreshedEvent.java </span><br><span class="line">                â”‚   â”‚   â””â”€â”€ SimpleApplicationEventMulticaster.java </span><br><span class="line">                â”‚   â”œâ”€â”€ support</span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ AbstractApplicationContext.java </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ AbstractRefreshableApplicationContext.java </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ AbstractXmlApplicationContext.java </span><br><span class="line">                â”‚   â”‚   â”œâ”€â”€ ApplicationContextAwareProcessor.java </span><br><span class="line">                â”‚   â”‚   â””â”€â”€ ClassPathXmlApplicationContext.java </span><br><span class="line">                â”‚   â”œâ”€â”€ ApplicationContext.java </span><br><span class="line">                â”‚   â”œâ”€â”€ ApplicationContextAware.java </span><br><span class="line">                â”‚   â”œâ”€â”€ ApplicationEvent.java </span><br><span class="line">                â”‚   â”œâ”€â”€ ApplicationEventPublisher.java </span><br><span class="line">                â”‚   â”œâ”€â”€ ApplicationListener.java </span><br><span class="line">                â”‚   â””â”€â”€ ConfigurableApplicationContext.java</span><br><span class="line">                â”‚â”€â”€ core.io</span><br><span class="line">                â”‚   â”œâ”€â”€ ClassPathResource.java </span><br><span class="line">                â”‚   â”œâ”€â”€ DefaultResourceLoader.java </span><br><span class="line">                â”‚   â”œâ”€â”€ FileSystemResource.java </span><br><span class="line">                â”‚   â”œâ”€â”€ Resource.java </span><br><span class="line">                â”‚   â”œâ”€â”€ ResourceLoader.java</span><br><span class="line">                â”‚   â””â”€â”€ UrlResource.java</span><br><span class="line">                â”‚â”€â”€ stereotype</span><br><span class="line">                â”‚   â””â”€â”€ Component.java</span><br><span class="line">                â””â”€â”€ utils</span><br><span class="line">                    â””â”€â”€ ClassUtils.java</span><br></pre></td></tr></table></figure>
<p>åœ¨Beançš„ç”Ÿå‘½å‘¨æœŸä¸­è‡ªåŠ¨åŠ è½½åŒ…æ‰«ææ³¨å†ŒBeanå¯¹è±¡å’Œè®¾ç½®å ä½ç¬¦å±æ€§çš„ç±»å…³ç³»</p>
<p><img src="/img/Spring/spring-12.png" /></p>
<ul>
<li><p>æ•´ä¸ªç±»çš„å…³ç³»ç»“æ„æ¥çœ‹ï¼Œå…¶å®æ¶‰åŠçš„å†…å®¹å¹¶ä¸å¤šï¼Œä¸»è¦åŒ…æ‹¬çš„å°±æ˜¯ xml
è§£æç±» XmlBeanDefinitionReader å¯¹ ClassPathBeanDefinitionScanner#doScan
çš„ä½¿ç”¨ã€‚</p></li>
<li><p>åœ¨ doScan
æ–¹æ³•ä¸­å¤„ç†æ‰€æœ‰æŒ‡å®šè·¯å¾„ä¸‹æ·»åŠ äº†æ³¨è§£çš„ç±»ï¼Œæ‹†è§£å‡ºç±»çš„ä¿¡æ¯ï¼šåç§°ã€ä½œç”¨èŒƒå›´ç­‰ï¼Œè¿›è¡Œåˆ›å»º
BeanDefinition å¥½ç”¨äº Bean å¯¹è±¡çš„æ³¨å†Œæ“ä½œã€‚</p></li>
<li><p>PropertyPlaceholderConfigurer
ç›®å‰çœ‹ä¸Šå»åƒä¸€å—å•ç‹¬çš„å†…å®¹ï¼Œåç»­ä¼šæŠŠè¿™å—çš„å†…å®¹ä¸è‡ªåŠ¨åŠ è½½ Bean
å¯¹è±¡è¿›è¡Œæ•´åˆï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åœ¨æ³¨è§£ä¸Šä½¿ç”¨å ä½ç¬¦é…ç½®ä¸€äº›åœ¨é…ç½®æ–‡ä»¶é‡Œçš„å±æ€§ä¿¡æ¯ã€‚</p></li>
</ul>
<h2 id="å¤„ç†å ä½ç¬¦é…ç½®">å¤„ç†å ä½ç¬¦é…ç½®</h2>
<p>beans.factory.PropertyPlaceholderConfigurer <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertyPlaceholderConfigurer</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Default placeholder prefix: &#123;<span class="doctag">@value</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PLACEHOLDER_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;$&#123;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Default placeholder suffix: &#123;<span class="doctag">@value</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PLACEHOLDER_SUFFIX</span> <span class="operator">=</span> <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½å±æ€§æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DefaultResourceLoader</span> <span class="variable">resourceLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultResourceLoader</span>();</span><br><span class="line">            <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> resourceLoader.getResource(location);</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            properties.load(resource.getInputStream());</span><br><span class="line"></span><br><span class="line">            String[] beanDefinitionNames = beanFactory.getBeanDefinitionNames();</span><br><span class="line">            <span class="keyword">for</span> (String beanName : beanDefinitionNames) &#123;</span><br><span class="line">                <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> beanFactory.getBeanDefinition(beanName);</span><br><span class="line"></span><br><span class="line">                <span class="type">PropertyValues</span> <span class="variable">propertyValues</span> <span class="operator">=</span> beanDefinition.getPropertyValues();</span><br><span class="line">                <span class="keyword">for</span> (PropertyValue propertyValue : propertyValues.getPropertyValues()) &#123;</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> propertyValue.getValue();</span><br><span class="line">                    <span class="keyword">if</span> (!(value <span class="keyword">instanceof</span> String)) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">strVal</span> <span class="operator">=</span> (String) value;</span><br><span class="line">                    <span class="type">StringBuilder</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(strVal);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">startIdx</span> <span class="operator">=</span> strVal.indexOf(DEFAULT_PLACEHOLDER_PREFIX);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">stopIdx</span> <span class="operator">=</span> strVal.indexOf(DEFAULT_PLACEHOLDER_SUFFIX);</span><br><span class="line">                    <span class="keyword">if</span> (startIdx != -<span class="number">1</span> &amp;&amp; stopIdx != -<span class="number">1</span> &amp;&amp; startIdx &lt; stopIdx) &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">propKey</span> <span class="operator">=</span> strVal.substring(startIdx + <span class="number">2</span>, stopIdx);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">propVal</span> <span class="operator">=</span> properties.getProperty(propKey);</span><br><span class="line">                        buffer.replace(startIdx, stopIdx + <span class="number">1</span>, propVal);</span><br><span class="line">                        propertyValues.addPropertyValue(<span class="keyword">new</span> <span class="title class_">PropertyValue</span>(propertyValue.getName(), buffer.toString()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeansException</span>(<span class="string">&quot;Could not load properties&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLocation</span><span class="params">(String location)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.location = location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>ä¾èµ–äº BeanFactoryPostProcessor åœ¨ Bean ç”Ÿå‘½å‘¨æœŸçš„å±æ€§ï¼Œå¯ä»¥åœ¨
Bean å¯¹è±¡å®ä¾‹åŒ–ä¹‹å‰ï¼Œæ”¹å˜å±æ€§ä¿¡æ¯ã€‚æ‰€ä»¥è¿™é‡Œé€šè¿‡å®ç°
BeanFactoryPostProcessor
æ¥å£ï¼Œå®Œæˆå¯¹é…ç½®æ–‡ä»¶çš„åŠ è½½ä»¥åŠæ‘˜å–å ä½ç¬¦ä¸­çš„åœ¨å±æ€§æ–‡ä»¶é‡Œçš„é…ç½®ã€‚</p></li>
<li><p>è¿™æ ·å°±å¯ä»¥æŠŠæå–åˆ°çš„é…ç½®ä¿¡æ¯æ”¾ç½®åˆ°å±æ€§é…ç½®ä¸­äº†ï¼Œbuffer.replace(startIdx,
stopIdx + 1, propVal); propertyValues.addPropertyValue</p></li>
</ul>
<h2 id="å®šä¹‰æ‹¦æˆªæ³¨è§£">å®šä¹‰æ‹¦æˆªæ³¨è§£</h2>
<p>annotation.Scope <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Scope &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;singleton&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>ç”¨äºé…ç½®ä½œç”¨åŸŸçš„è‡ªå®šä¹‰æ³¨è§£ï¼Œæ–¹ä¾¿é€šè¿‡é…ç½®Beanå¯¹è±¡æ³¨è§£çš„æ—¶å€™ï¼Œæ‹¿åˆ°Beanå¯¹è±¡çš„ä½œç”¨åŸŸã€‚ä¸è¿‡ä¸€èˆ¬éƒ½ä½¿ç”¨é»˜è®¤çš„
singleton</li>
</ul>
<p>stereotype.Component <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Component &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Component è‡ªå®šä¹‰æ³¨è§£å¤§å®¶éƒ½éå¸¸ç†Ÿæ‚‰äº†ï¼Œç”¨äºé…ç½®åˆ° Class
ç±»ä¸Šçš„ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰
Serviceã€Controllerï¼Œä¸è¿‡æ‰€æœ‰çš„å¤„ç†æ–¹å¼åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œå°±åªå±•ç¤ºä¸€ä¸ª
Component å³å¯ã€‚</li>
</ul>
<h2 id="å¤„ç†å¯¹è±¡æ‰«æè£…é…">å¤„ç†å¯¹è±¡æ‰«æè£…é…</h2>
<p>context.annotation.ClassPathScanningCandidateComponentProvider
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathScanningCandidateComponentProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;BeanDefinition&gt; <span class="title function_">findCandidateComponents</span><span class="params">(String basePackage)</span> &#123;</span><br><span class="line">        Set&lt;BeanDefinition&gt; candidates = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">        Set&lt;Class&lt;?&gt;&gt; classes = ClassUtil.scanPackageByAnnotation(basePackage, Component.class);</span><br><span class="line">        <span class="keyword">for</span> (Class&lt;?&gt; clazz : classes) &#123;</span><br><span class="line">            candidates.add(<span class="keyword">new</span> <span class="title class_">BeanDefinition</span>(clazz));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> candidates;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>è¿™é‡Œå…ˆè¦æä¾›ä¸€ä¸ªå¯ä»¥é€šè¿‡é…ç½®è·¯å¾„
basePackage=cn.bugstack.springframework.test.beanï¼Œè§£æå‡º classes
ä¿¡æ¯çš„å·¥å…·æ–¹æ³• findCandidateComponentsï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥æ‰«æåˆ°æ‰€æœ‰
<span class="citation" data-cites="Component">@Component</span> æ³¨è§£çš„
Bean å¯¹è±¡äº†ã€‚</li>
</ul>
<p>context.annotation.ClassPathBeanDefinitionScanner <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> <span class="keyword">extends</span> <span class="title class_">ClassPathScanningCandidateComponentProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BeanDefinitionRegistry registry;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassPathBeanDefinitionScanner</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.registry = registry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String basePackage : basePackages) &#123;</span><br><span class="line">            Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);</span><br><span class="line">            <span class="keyword">for</span> (BeanDefinition beanDefinition : candidates) &#123;</span><br><span class="line">                <span class="comment">// è§£æ Bean çš„ä½œç”¨åŸŸ singletonã€prototype</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">beanScope</span> <span class="operator">=</span> resolveBeanScope(beanDefinition);</span><br><span class="line">                <span class="keyword">if</span> (StrUtil.isNotEmpty(beanScope)) &#123;</span><br><span class="line">                    beanDefinition.setScope(beanScope);</span><br><span class="line">                &#125;</span><br><span class="line">                registry.registerBeanDefinition(determineBeanName(beanDefinition), beanDefinition);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">resolveBeanScope</span><span class="params">(BeanDefinition beanDefinition)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; beanClass = beanDefinition.getBeanClass();</span><br><span class="line">        <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> beanClass.getAnnotation(Scope.class);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != scope) <span class="keyword">return</span> scope.value();</span><br><span class="line">        <span class="keyword">return</span> StrUtil.EMPTY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">determineBeanName</span><span class="params">(BeanDefinition beanDefinition)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; beanClass = beanDefinition.getBeanClass();</span><br><span class="line">        <span class="type">Component</span> <span class="variable">component</span> <span class="operator">=</span> beanClass.getAnnotation(Component.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> component.value();</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isEmpty(value)) &#123;</span><br><span class="line">            value = StrUtil.lowerFirst(beanClass.getSimpleName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>ClassPathBeanDefinitionScanner æ˜¯ç»§æ‰¿è‡ª
ClassPathScanningCandidateComponentProvider çš„å…·ä½“æ‰«æåŒ…å¤„ç†çš„ç±»ï¼Œåœ¨
doScan ä¸­é™¤äº†è·å–åˆ°æ‰«æçš„ç±»ä¿¡æ¯ä»¥åï¼Œè¿˜éœ€è¦è·å– Bean
çš„ä½œç”¨åŸŸå’Œç±»åï¼Œå¦‚æœä¸é…ç½®ç±»ååŸºæœ¬éƒ½æ˜¯æŠŠé¦–å­—æ¯ç¼©å†™ã€‚</li>
</ul>
<h2 id="è§£æxmlä¸­è°ƒç”¨æ‰«æ">è§£æxmlä¸­è°ƒç”¨æ‰«æ</h2>
<p>beans.factory.xml.XmlBeanDefinitionReader <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlBeanDefinitionReader</span> <span class="keyword">extends</span> <span class="title class_">AbstractBeanDefinitionReader</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doLoadBeanDefinitions</span><span class="params">(InputStream inputStream)</span> <span class="keyword">throws</span> ClassNotFoundException, DocumentException &#123;</span><br><span class="line">        <span class="type">SAXReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">        <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> reader.read(inputStream);</span><br><span class="line">        <span class="type">Element</span> <span class="variable">root</span> <span class="operator">=</span> document.getRootElement();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£æ context:component-scan æ ‡ç­¾ï¼Œæ‰«æåŒ…ä¸­çš„ç±»å¹¶æå–ç›¸å…³ä¿¡æ¯ï¼Œç”¨äºç»„è£… BeanDefinition</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">componentScan</span> <span class="operator">=</span> root.element(<span class="string">&quot;component-scan&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != componentScan) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">scanPath</span> <span class="operator">=</span> componentScan.attributeValue(<span class="string">&quot;base-package&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isEmpty(scanPath)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeansException</span>(<span class="string">&quot;The value of base-package attribute can not be empty or null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            scanPackage(scanPath);</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// ... çœç•¥å…¶ä»–</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment">// æ³¨å†Œ BeanDefinition</span></span><br><span class="line">        getRegistry().registerBeanDefinition(beanName, beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">scanPackage</span><span class="params">(String scanPath)</span> &#123;</span><br><span class="line">        String[] basePackages = StrUtil.splitToArray(scanPath, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        <span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(getRegistry());</span><br><span class="line">        scanner.doScan(basePackages);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>å…³äº XmlBeanDefinitionReader
ä¸­ä¸»è¦æ˜¯åœ¨åŠ è½½é…ç½®æ–‡ä»¶åï¼Œå¤„ç†æ–°å¢çš„è‡ªå®šä¹‰é…ç½®å±æ€§
component-scanï¼Œè§£æåè°ƒç”¨ scanPackage æ–¹æ³•ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨
ClassPathBeanDefinitionScanner#doScan åŠŸèƒ½ã€‚</p></li>
<li><p>å¦å¤–è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä¸ºäº†å¯ä»¥æ–¹ä¾¿çš„åŠ è½½å’Œè§£æxmlï¼ŒXmlBeanDefinitionReader
å·²ç»å…¨éƒ¨æ›¿æ¢ä¸º dom4j çš„æ–¹å¼è¿›è¡Œè§£æå¤„ç†ã€‚</p></li>
</ul>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mini-spring/">mini-spring</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/pages/mini-spring/11/" title="Spring11ï¼šæŠŠAOPåŠ¨æ€ä»£ç†ï¼Œèå…¥åˆ°Beançš„ç”Ÿå‘½å‘¨æœŸ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Spring11ï¼šæŠŠAOPåŠ¨æ€ä»£ç†ï¼Œèå…¥åˆ°Beançš„ç”Ÿå‘½å‘¨æœŸ</div></div></a><a class="next-post pull-right" href="/pages/mini-spring/13/" title="Spring13ï¼šé€šè¿‡æ³¨è§£ç»™å±æ€§æ³¨å…¥é…ç½®å’ŒBeanå¯¹è±¡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Spring13ï¼šé€šè¿‡æ³¨è§£ç»™å±æ€§æ³¨å…¥é…ç½®å’ŒBeanå¯¹è±¡</div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a href="/pages/mini-spring/01/" title="Spring01ï¼šå®ç° Bean çš„å®šä¹‰ã€æ³¨å†Œã€è·å–"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-11</div><div class="title">Spring01ï¼šå®ç° Bean çš„å®šä¹‰ã€æ³¨å†Œã€è·å–</div></div></a><a href="/pages/mini-spring/02/" title="Spring02ï¼šåŸºäºCglibå®ç°å«æ„é€ å‡½æ•°çš„ç±»å®ä¾‹åŒ–ç­–ç•¥"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-11</div><div class="title">Spring02ï¼šåŸºäºCglibå®ç°å«æ„é€ å‡½æ•°çš„ç±»å®ä¾‹åŒ–ç­–ç•¥</div></div></a><a href="/pages/mini-spring/03/" title="Spring03ï¼šä¸ºBeanå¯¹è±¡æ³¨å…¥å±æ€§å’Œä¾èµ–Beançš„åŠŸèƒ½å®ç°"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-11</div><div class="title">Spring03ï¼šä¸ºBeanå¯¹è±¡æ³¨å…¥å±æ€§å’Œä¾èµ–Beançš„åŠŸèƒ½å®ç°</div></div></a><a href="/pages/mini-spring/04/" title="Spring04ï¼šèµ„æºåŠ è½½å™¨ï¼Œä»Spring.xmlè§£æå’Œæ³¨å†ŒBeanå¯¹è±¡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-11</div><div class="title">Spring04ï¼šèµ„æºåŠ è½½å™¨ï¼Œä»Spring.xmlè§£æå’Œæ³¨å†ŒBeanå¯¹è±¡</div></div></a><a href="/pages/mini-spring/06/" title="Spring06ï¼šå‘è™šæ‹Ÿæœºæ³¨å†Œé’©å­ï¼Œå®ç°Beanå¯¹è±¡çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-12</div><div class="title">Spring06ï¼šå‘è™šæ‹Ÿæœºæ³¨å†Œé’©å­ï¼Œå®ç°Beanå¯¹è±¡çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•</div></div></a><a href="/pages/mini-spring/07/" title="Spring07ï¼šå®šä¹‰æ ‡è®°ç±»å‹Awareæ¥å£ï¼Œå®ç°æ„ŸçŸ¥å®¹å™¨å¯¹è±¡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-12</div><div class="title">Spring07ï¼šå®šä¹‰æ ‡è®°ç±»å‹Awareæ¥å£ï¼Œå®ç°æ„ŸçŸ¥å®¹å™¨å¯¹è±¡</div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Animenzzzzzz</div><div class="author-info-description">å‘æ¥å¦‚æ­¤ï¼Œä¾¿å¯¹ä¹ˆï¼Ÿ</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Animenzzzzzz"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Animenzzzzzz" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:jinnianqianyin@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">å˜¿å’»~å˜¿å’»~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87"><span class="toc-number">2.</span> <span class="toc-text">ç›®æ ‡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B9%E6%A1%88"><span class="toc-number">3.</span> <span class="toc-text">æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.</span> <span class="toc-text">å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">å·¥ç¨‹ç»“æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%8D%A0%E4%BD%8D%E7%AC%A6%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">å¤„ç†å ä½ç¬¦é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.3.</span> <span class="toc-text">å®šä¹‰æ‹¦æˆªæ³¨è§£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%AF%B9%E8%B1%A1%E6%89%AB%E6%8F%8F%E8%A3%85%E9%85%8D"><span class="toc-number">4.4.</span> <span class="toc-text">å¤„ç†å¯¹è±¡æ‰«æè£…é…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90xml%E4%B8%AD%E8%B0%83%E7%94%A8%E6%89%AB%E6%8F%8F"><span class="toc-number">4.5.</span> <span class="toc-text">è§£æxmlä¸­è°ƒç”¨æ‰«æ</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Animenzzzzzz</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = (ele) => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from(ele).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({svg}) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return
    
    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }
  
  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script></div></body></html>